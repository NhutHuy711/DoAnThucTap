<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments :: page_head('FreshCart', 'none')"/>

<body>
    <div class="border-bottom">
        <div th:replace="navigation :: header_menu"></div>
        <div th:replace="navigation :: search_nav"></div>
        <div th:replace="navigation :: category_nav"></div>
        <div th:replace="fragments :: loading_spinner"></div>
    </div>
<main>
        <section class="mt-8">
            <div class="container">
                <div class="hero-slider">
                    <!-- Slider item 1 -->
                    <div th:style="'background: url(' + @{/images/slider/slider-1.jpg} + ')no-repeat; background-size: cover; border-radius: .5rem;'">
                        <div class="ps-lg-12 py-lg-16 col-xxl-5 col-md-7 py-14 px-8 text-xs-center">
                            <span class="badge text-bg-warning">Grand Opening – Up to 50% Off</span>
                            <h2 class="text-dark display-5 fw-bold mt-4">TechLap – Your Trusted Laptop Store</h2>
                            <p class="lead">Redefining how you shop laptops online with fast delivery and unbeatable service.</p>
                            <a href="#!" class="btn btn-dark mt-3">Shop Now <i class="feather-icon icon-arrow-right ms-1"></i></a>
                        </div>
                    </div>

                    <!-- Slider item 2 -->
                    <div th:style="'background: url(' + @{/images/slider/hero-img-slider-2.jpg} + ')no-repeat; background-size: cover; border-radius: .5rem;'">
                        <div class="ps-lg-12 py-lg-16 col-xxl-5 col-md-7 py-14 px-8 text-xs-center">
                            <span class="badge text-bg-danger">Hot Deals</span>
                            <h2 class="text-dark display-5 fw-bold mt-4">Latest Laptops at Best Prices</h2>
                            <p class="lead">Enjoy up to 50% off on your first purchase. Shop now for genuine and high-performance tech products.</p>
                            <a href="#!" class="btn btn-danger mt-3">Shop Now <i class="feather-icon icon-arrow-right ms-1"></i></a>
                        </div>
                    </div>

                    <!-- Slider item 3 -->
                    <div th:style="'background: url(' + @{/images/slider/slider-2.jpg} + ')no-repeat; background-size: cover; border-radius: .5rem;'">
                        <div class="ps-lg-12 py-lg-16 col-xxl-5 col-md-7 py-14 px-8 text-xs-center">
                            <span class="badge text-bg-success">Genuine Products</span>
                            <h2 class="text-dark display-5 fw-bold mt-4">100% Authentic & Brand New</h2>
                            <p class="lead">Start your tech journey with our certified laptops and accessories – guaranteed genuine.</p>
                            <a href="#!" class="btn btn-success mt-3">Explore Now <i class="feather-icon icon-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <section class="mb-lg-10 mt-lg-14 my-8" id="featured-categories">
            <div class="container">
                <div class="row">
                    <div class="col-12 mb-6">
                        <h3 class="mb-0">Featured Categories</h3>
                    </div>
                </div>
                <div class="category-slider">
                    <div class="item" th:each="cat : ${listCategories}">
                        <a th:href="@{'/category/' + ${cat.alias}}" class="text-decoration-none text-inherit">
                            <div class="card card-product mb-lg-4">
                                <div class="card-body text-center py-8 d-flex flex-column align-items-center justify-content-center category-card">
                                    <div class="category-image-wrapper">
                                        <img th:if="${cat.image != null}"
                                             th:src="@{${cat.imagePath}}"
                                             th:alt="${cat.name}"
                                             class="category-image">
                                    </div>
                                    <div class="text-truncate mt-3" th:text="${cat.name}">Category Name</div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <section class="my-lg-14 mb-8" id="special-offer">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-8">
                            <div>
                                <h3 class="mb-0">Special Offers of the Week!</h3>
                                <p class="mb-0">Get up to 50% off on your first order</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="product-slider">
                    <div class="col" th:each="product : ${listSpecialOffers}">
                        <div th:replace="fragments :: product_card"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="my-lg-14 my-8" id="best-sellers">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-8">
                            <div>
                                <h3 class="mb-0">Bestsellers In Your Area</h3>
                                <p class="mb-0">Most popular products near you</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="product-slider">
                    <div class="col" th:each="product : ${listBestSellers}">
                        <div th:replace="fragments :: product_card"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-lg-14 my-8" id="new-products" >
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-8">
                            <div>
                                <h3 class="mb-0">New Products</h3>
                                <p class="mb-0">New products with updated stocks</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="product-slider">
                    <div class="col" th:each="product : ${listNewProducts}">
                        <div th:replace="fragments :: product_card"></div>
                    </div>
                </div>
            </div>
        </section>



</main>
<section class="my-lg-14 mb-8">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-3">
                    <div class="mb-8 mb-xl-0">
                        <div class="mb-6"><img th:src="@{/images/icons/clock.svg}" alt=""></div>
                        <h3 class="h5 mb-3">Superfast Laptop Delivery in 10 Minutes</h3>
                        <p>Place your order now at TechLap and receive your laptop at home from the nearest store.</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="mb-8 mb-xl-0">
                        <div class="mb-6"><img th:src="@{/images/icons/gift.svg}" alt=""></div>
                        <h3 class="h5 mb-3">Best Laptop Deals & Exclusive Offers</h3>
                        <p>Better prices than retail stores, plus exclusive cashback and promotions. Shop smart at TechLap.</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="mb-8 mb-xl-0">
                        <div class="mb-6"><img th:src="@{/images/icons/package.svg}" alt=""></div>
                        <h3 class="h5 mb-3">Wide Selection of Products</h3>
                        <p>Explore a wide range of laptops, accessories, and tech gadgets tailored for study, work, and entertainment.</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="mb-8 mb-xl-0">
                        <div class="mb-6"><img th:src="@{/images/icons/refresh-cw.svg}" alt=""></div>
                        <h3 class="h5 mb-3">Hassle-Free Returns</h3>
                        <p>
                            Not satisfied with your laptop or accessory? Return it right at your doorstep and receive a quick refund – no questions asked.
                            <a href="#!">Return policy</a>.
                        </p>
                    </div>
                </div>
            </div>
        </div>
</section>


<div th:replace="navigation :: footer_menu"></div>

<script type="text/javascript">
    contextPath = "[[@{/}]]";
    var csrfHeaderName = "[[${_csrf.headerName}]]";
    var csrfValue = "[[${_csrf.token}]]";
    decimalSeparator = "[[${DECIMAL_POINT_TYPE == 'COMMA' ? ',' : '.'}]]";
    thousandSeparator = "[[${THOUSANDS_POINT_TYPE == 'COMMA' ? ',' : '.'}]]";
</script>
<script type="text/javascript" th:src="@{/libs/slick-carousel/slick/slick.min.js}"></script>
<script type="text/javascript" th:src="@{/js/slick-slider.js}"></script>
<script type="text/javascript" th:src="@{/js/common_toast.js}"></script>
<script type="text/javascript" th:src="@{/js/cart.js}"></script>

<!-- <script type="text/javascript" th:src="@{/js/theme-switcher.js}"></script> -->

    <!-- Chatbot UI -->
    <div id="chatbot-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
        <div id="chatbox" style="display: none; width: 300px; height: 400px; background: white; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.2); overflow: hidden; display: flex; flex-direction: column;">
            <div style="background: #0d6efd; color: white; padding: 10px; text-align: center;">Gemini Chatbot</div>
            <div id="chatlog" style="flex: 1; padding: 10px; overflow-y: auto; font-size: 14px;"></div>
            <div style="display: flex; border-top: 1px solid #ccc;">
                <input id="chat-input" type="text" placeholder="Nhập câu hỏi..." style="flex: 1; border: none; padding: 10px;" />
                <button onclick="sendMessage()" style="border: none; background: #0d6efd; color: white; padding: 10px;">Gửi</button>
            </div>
        </div>
        <button onclick="toggleChatbox()" style="background: #0d6efd; color: white; border: none; padding: 12px 16px; border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.3);">
            💬
        </button>
    </div>

    <script>
        // Lấy context path từ Thymeleaf
        const contextPath = "[[@{/}]]";  // Sẽ resolve thành "/FreshCart/"

        function toggleChatbox() {
            const box = document.getElementById('chatbox');
            box.style.display = box.style.display === 'none' ? 'flex' : 'none';
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const chatlog = document.getElementById('chatlog');
            const message = input.value.trim();
            if (message === "") return;

            // Hiển thị câu hỏi người dùng
            chatlog.innerHTML += `<div><b>Bạn:</b> ${message}</div>`;
            input.value = "";

            try {
                const response = await fetch(contextPath + "chatbot/ask", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        [csrfHeaderName]: csrfValue
                    },
                    body: JSON.stringify(message)
                });

                const data = await response.json();

                let answer = data.reply || "Không có phản hồi";

                chatlog.innerHTML += `<div><b>Gemini:</b> ${answer}</div>`;
                chatlog.scrollTop = chatlog.scrollHeight;
            } catch (err) {
                chatlog.innerHTML += `<div><b>Lỗi:</b> Không thể gửi câu hỏi (${err.message})</div>`;
                console.error("Lỗi gửi câu hỏi:", err);
            }
        }

    </script>

</body>

</html>